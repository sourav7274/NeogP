<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body class="container mt-5">
    <h1>Employee Management</h1>
    <div class="row" id="show"></div>

    <script>

        const  apiUrl = 'https://employee-management-backend-student-neog-ca.replit.app/employees'
        const show = document.getElementById("show")

       function fetchData()
       {
        fetch(apiUrl).then(function(response){
            return response.json()
        }).then(function(data){
            if(data)
            {
                show.textContent= ''
                for(let i=0;i<data.length;i++)
                {
                    const liE = document.createElement("p")
                    liE.className = 'col-md-12'
                    liE.innerHTML = `
                    ${data[i].name} - Department: ${data[i].department} - Gender: ${data[i].gender}
                    <button id="deleteB" data-id = "${data[i]._id}" class = "btn btn-danger float-end">Delete</button>
                    `
                    show.appendChild(liE)
                }
                const deleteB = document.querySelectorAll("#deleteB")
                for(let i=0;i<deleteB.length;i++)
                {
                    console.log(deleteB[i])
                    deleteB[i].addEventListener("click",function(event){
                        const emplId = event.target.getAttribute('data-id')
                        fetch(`${apiUrl}/${emplId}`,{
                            method:"DELETE"
                        }).then(function(response){
                            return response.json()
                        }).then(function(data){
                            
                            if(data)
                            {
                                show.textContent = "Loading....."
                                fetchData()
                            }
                        })
                    })
                }
            }
            else
            {
                show.textContent = `Data Not Found`
            }
        }).catch(function(error){
            show.textContent = `Could not load data`
        })
       }
       
       fetchData()

    </script>
</body>
</html>